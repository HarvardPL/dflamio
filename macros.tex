\newcommand{\TODO}[1]{\textcolor{red}{#1}}
\newcommand{\BRAINDUMP}[1]{\textcolor{blue}{#1}}
\newcommand{\lang}{DFLAMIO}
\newcommand{\name}{n}
\newcommand{\Nameset}{\mathcal{N}}
\newcommand{\conj}{\mathrel{\land}}
\newcommand{\disj}{\mathrel{\lor}}
\newcommand{\conf}[1]{#1^{\rightarrow}}
\newcommand{\integ}[1]{#1^{\leftarrow}}
\newcommand{\owner}[2]{#1\!:\!#2}
\newcommand{\addr}{a}
\newcommand{\Attacker}{\mathcal{A}}
\newcommand{\Addr}{A}
\newcommand{\val}{v}
\newcommand{\expr}{e}
\newcommand{\Var}{\mathsf{Var}}
\newcommand{\true}{\mathsf{true}}
\newcommand{\false}{\mathsf{false}}
\newcommand{\abs}[4]{\lambda^{#1}_{#2}\,#3.\,#4}
\newcommand{\lb}[2]{#2 \mathbin{@} #1}
\newcommand{\type}{\tau}
\newcommand{\cons}[2]{#1 \mathbin{::} #2}
\newcommand{\nil}{\mathsf{nil}}
\newcommand{\liokw}{\mathsf{LIO}}
\newcommand{\lio}[1]{(#1)^{\liokw}}
\newcommand{\app}[2]{#1\;#2}
\newcommand{\proj}[2]{\pi_{#1}\,#2}
\newcommand{\ifkw}{\mathsf{if}}
\newcommand{\thenkw}{\mathsf{then}}
\newcommand{\elsekw}{\mathsf{else}}
\newcommand{\ifexpr}[3]{\ifkw\;#1\;\thenkw\;#2\;\elsekw\;#3}
\newcommand{\casekw}{\mathsf{case}}
\newcommand{\ofkw}{\mathsf{of}}
\newcommand{\case}[3]{\casekw\;#1\;\ofkw\;#2\;#3}
\newcommand{\fixkw}{\mathsf{fix}}
\newcommand{\fix}[1]{\fixkw\;#1}
\newcommand{\returnkw}{\mathsf{return}}
\newcommand{\return}[1]{\returnkw\;#1}
\newcommand{\bindop}{\mathbin{\raisebox{-0.1ex}{\mintinline{haskell}{>>=}}}}
\newcommand{\bind}[2]{#1 \bindop #2}
\DeclareMathOperator{\readrefkw}{!}
\newcommand{\readref}[1]{\readrefkw #1}
\newcommand{\writeref}[2]{#1 := #2}
\newcommand{\getlabel}{\mathsf{getLabel}}
\newcommand{\getclearance}{\mathsf{getClearance}}
\newcommand{\labelofkw}{\mathsf{labelOf}}
\newcommand{\labelof}[1]{\labelofkw\;#1}
\newcommand{\newkw}{\mathsf{new}}
\newcommand{\new}[2]{\newkw\;#1\;#2}
\newcommand{\labelkw}{\mathsf{label}}
\newcommand{\Label}[2]{\labelkw\;#1\;#2}
\newcommand{\unlabelkw}{\mathsf{unlabel}}
\newcommand{\unlabel}[1]{\unlabelkw\;#1}
\newcommand{\tolabeledkw}{\mathsf{toLabeled}}
\newcommand{\tolabeled}[2]{\tolabeledkw\;#1\;#2}
\newcommand{\withscopekw}{\mathsf{withScope}}
\newcommand{\withscope}[1]{\withscopekw\;#1}
\newcommand{\withstrategykw}{\mathsf{withStrategy}}
\newcommand{\withstrategy}[2]{\withstrategykw\;#1\;#2}
\newcommand{\adddelegatekw}{\mathsf{assume}}
\newcommand{\adddelegate}[3]{\adddelegatekw\;(#1 \actsfor #2) \;@ \; #3}
\newcommand{\removedelegatekw}{\mathsf{discard}}
\newcommand{\removedelegate}[3]{\removedelegatekw\;(#1 \actsfor #2)\;#3}
\newcommand{\getstrategy}{\mathsf{getStrategy}}
\newcommand{\actsfor}{\succcurlyeq}
\NewDocumentCommand{\wait}{ m O{}}{\mathsf{wait}_{#2}(#1)}
\newcommand{\resetstrategy}[2]{\mathsf{resetStrategy}_{#1}(#2)}
\newcommand{\resetscope}[2]{\mathsf{resetScope}_{#1}(#2)}
\NewDocumentCommand{\resetTolabeled}{ O{} m m m }{\tolabeledkw^{#1}_{#2}\;#3\;#4}
\newcommand{\scope}{\Delta}
\newcommand{\termsym}{\bullet}
\newcommand{\bool}{\mathsf{Bool}}
\newcommand{\unit}{\mathsf{Unit}}
\newcommand{\String}{\mathsf{String}}
\newcommand{\Integer}{\mathsf{Int}}
\newcommand{\func}[2]{#1 \to #2}
\newcommand{\pair}[2]{#1 \times #2}
\newcommand{\listtype}[1]{\lbrack#1\rbrack}
\newcommand{\labeltype}{\mathsf{Principal}}
\newcommand{\labeledkw}{\mathsf{Labeled}}
\newcommand{\labeled}[1]{\labeledkw\,#1}
\newcommand{\liotype}[1]{\liokw\,#1}
\newcommand{\refkw}{\mathsf{Ref}}
\NewDocumentCommand{\reftype}{ O{} m}{\refkw_{#1}\,#2}
\newcommand{\store}{\phi}
\newcommand{\ruleref}[1]{\textsc{#1}}
\definecolor{verylightgray}{rgb}{0.9,0.9,0.9}
\newcommand{\graybox}[1]{\fcolorbox{white}{verylightgray}{\ensuremath{#1}}}

\NewDocumentCommand{\stepsto}{ O{} O{} }{\xrightarrow[#1]{\mathmakebox[1em]{#2}}}
\NewDocumentCommand{\steppure}{O{} O{} m m }{#3 \stepsto[#1][#2] #4}
\newcommand{\ectx}{E}
\newcommand{\hole}{\lbrack \bullet \rbrack}
\newcommand{\efill}[1]{\ectx\lbrack #1 \rbrack}
\newcommand{\hd}{\mathsf{hd}}
\newcommand{\tl}{\mathsf{tl}}

\newcommand{\config}[2]{\langle #1 \mid #2 \rangle}
\NewDocumentCommand{\step}{ m O{} O{} m m m }{#1 \vdash #4 \stepsto[#2][#3] #5 : #6}
\newcommand{\env}{\Sigma}
\newcommand{\lblkw}{\mathsf{lbl}}
\newcommand{\flowstoquery}[4]{#1 \vdash #2 \flowsto #3 : #4}
\newcommand{\flowsto}{\sqsubseteq}
\newcommand{\level}{\ell}
\newcommand{\extend}[3]{#1 \lbrack #2 \mapsto #3 \rbrack}
\newcommand{\join}{\sqcup}
\newcommand{\dom}{\mathsf{dom}}
\newcommand{\nopostflowstoquery}[3]{#1 \vdash #2 \flowsto #3}
\newcommand{\nopostactsforquery}[3]{#1 \vdash #2 \actsfor #3}
\newcommand{\actsforquery}[4]{#1 \vdash #2 \actsfor #3 : #4}
\newcommand{\notactsforquery}[4]{#1 \vdash #2 \not\actsfor #3 : #4}
\newcommand{\strategy}{\mathsf{strat}}
\newcommand{\voicekw}{\nabla}
\newcommand{\voice}[1]{\voicekw(#1)}
\newcommand{\extends}[2]{#1 \lbrack #2 \rbrack}
\newcommand{\actsforquerycount}[5]{#1 \vdash^{\!\! #5} #2 \actsfor #3 : #4}

\newcommand{\gconfig}[3]{\llparenthesis #1, #2, #3 \rrparenthesis}
\NewDocumentCommand{\gstepsto}{ O{} O{} }{\xRightarrow[#1]{\mathmakebox[1em]{#2}}}
\NewDocumentCommand{\gstepstos}{ O{} O{} O{*} }{\xRightarrow[#1]{\mathmakebox[1em]{#2}}{}\!\!^{#3}}

\newcommand{\Assumps}{\mathcal{H}}
\newcommand{\authproj}[1]{#1^{\pi}}
\WithSuffix\newcommand\actsforquerymany*[5]{#1 \vdash^*_{#2} #3 \actsfor #4 : #5}
\newcommand{\actsforquerysmany}[5]{#1 \vdash_{#2} #3 \actsfor #4 : #5}

\NewDocumentCommand{\hastype}{ O{} m m m }{#2 \vdash_{#1} #3 : #4}
\newcommand{\tenv}{\Gamma}
\newcommand{\wf}[2]{#1 \vdash #2}

\newcommand{\event}{\mathit{ev}}
\newcommand{\good}[2]{#1 \vdash \mathsf{good}(#2)}
\newcommand{\globalstore}{\Phi}
\newcommand{\altglobalstore}{\Psi}
\newcommand{\filtertrace}{\leadsto}
\NewDocumentCommand{\traceloweq}{m m m O{} }{#1 \simeq_{#2}^{#4} #3}
\NewDocumentCommand{\loweq}{ m m O{} m m }{#1 \vdash #4 \simeq_{#2}^{#3} #5}
\newcommand{\emptyenv}{\varnothing}

\definecolor{bluekeywords}{rgb}{0.13, 0.13, 1}
\definecolor{greencomments}{rgb}{0, 0.5, 0}
\definecolor{redstrings}{rgb}{0.9, 0, 0}
\definecolor{graynumbers}{rgb}{0.5, 0.5, 0.5}

\lstset{
    columns=fullflexible,
    showspaces=false,
    showtabs=false,
    breaklines=true,
    showstringspaces=false,
    breakatwhitespace=true,
    escapeinside={(*@}{@*)},
    commentstyle=\color{greencomments},
    keywordstyle=\color{bluekeywords},
    stringstyle=\color{redstrings},
    numberstyle=\color{graynumbers},
    basicstyle=\ttfamily\footnotesize,
    frame=l,
    framesep=12pt,
    xleftmargin=12pt,
    tabsize=4,
    captionpos=b,
    emph={%  
    true, false, nil, if, then, else, case, of, fix, return, new, label, unlabel, toLabeled, getLabel, getClearance, labelOf, withScope, withStrategy, assume, discard, getStrategy, wait, resetStrategy, resetScope, Bool, Unit, Principal, Labeled, LIO, Ref
    },
    emphstyle={\bfseries}
}

\newtheorem{theorem}{Theorem}[section]